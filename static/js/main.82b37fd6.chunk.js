(this["webpackJsonpwebrtc-janus"]=this["webpackJsonpwebrtc-janus"]||[]).push([[0],{18:function(e,r,n){},33:function(e,r,n){},41:function(e,r,n){"use strict";n.r(r);var o=n(0),t=n.n(o),i=n(20),a=n.n(i),s=(n(33),n.p,n(18),n(24)),d=n(4),c=n(21),l=n(22),u=n(28),f=n(27),v=n.p+"static/media/offline.a557cfc8.jpg",g=n(9),m=n(26),p=window.RTCRtpTransceiver;h.sessions={},h.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),r=33;return window.navigator.userAgent.match("Linux")&&(r=35),e>=26&&e<=r||h.extension.isInstalled()}return!0};var b={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var r=window.setTimeout((function(){var r=new Error("NavigatorUserMediaError");return r.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(r)}),1e3);this.cache[r]=e,window.postMessage({type:"janusGetScreen",id:r},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(r){if(r.origin==window.location.origin)if("janusGotScreen"==r.data.type&&e[r.data.id]){var n=e[r.data.id];if(delete e[r.data.id],""===r.data.sourceId){var o=new Error("NavigatorUserMediaError");o.name="You cancelled the request for permission, giving up...",n(o)}else n(null,r.data.sourceId)}else"janusGetScreenPending"==r.data.type&&(console.log("clearing ",r.data.id),window.clearTimeout(r.data.id))}))}};function h(e){if((e=e||{}).success="function"==typeof e.success?e.success:h.noop,e.error="function"==typeof e.error?e.error:h.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:h.noop,!h.initDone)return e.error("Library not initialized"),{};if(!h.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(h.log("Library initialized: "+h.initDone),!e.server)return e.error("Invalid server url"),{};var r=!1,n=null,o={},t=null,i=null,a=0,s=e.server;h.isArray(s)?(h.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,h.debug(i)):0===s.indexOf("ws")?(r=!0,h.log("Using WebSockets to contact Janus: "+s)):(r=!1,h.log("Using REST API to contact Janus: "+s));var d=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var v=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(v=e.max_poll_events),v<1&&(v=1);var m=null;void 0!==e.token&&null!==e.token&&(m=e.token);var p=null;void 0!==e.apisecret&&null!==e.apisecret&&(p=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var b=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(b=e.keepAlivePeriod),isNaN(b)&&(b=25e3);var w=6e4;function S(e){var r={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(r.high=e.high),e.medium&&(r.medium=e.medium),e.low&&(r.low=e.low)),r}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(w=e.longPollTimeout),isNaN(w)&&(w=6e4);var y=!1,k=null,T={},C=this,D=0,A={};function R(){if(null!=k)if(h.debug("Long poll..."),y){var r=s+"/"+k+"?rid="+(new Date).getTime();v&&(r=r+"&maxev="+v),m&&(r=r+"&token="+encodeURIComponent(m)),p&&(r=r+"&apisecret="+encodeURIComponent(p)),h.httpAPICall(r,{verb:"GET",withCredentials:f,success:j,timeout:w,error:function(r,n){if(h.error(r+":",n),++D>3)return y=!1,void e.error("Lost connection to the server (is it down?)");R()}})}else h.warn("Is the server down? (connected=false)")}function j(e,o){if(D=0,r||void 0===k||null===k||!0===o||R(),r||!h.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(d=e.sender))return void h.warn("Missing sender...");if(!(l=T[d]))return void h.debug("This handle is not attached to this session");var t=e.candidate;h.debug("Got a trickled candidate on session "+k),h.debug(t);var i=l.webrtcStuff;i.pc&&i.remoteSdp?(h.debug("Adding remote candidate:",t),t&&!0!==t.completed?i.pc.addIceCandidate(t):i.pc.addIceCandidate(h.endOfCandidates)):(h.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(t),h.debug(i.candidates))}else{if("webrtcup"===e.janus)return h.debug("Got a webrtcup event on session "+k),h.debug(e),(d=e.sender)?(l=T[d])?void l.webrtcState(!0):void h.debug("This handle is not attached to this session"):void h.warn("Missing sender...");if("hangup"===e.janus){if(h.debug("Got a hangup event on session "+k),h.debug(e),!(d=e.sender))return void h.warn("Missing sender...");if(!(l=T[d]))return void h.debug("This handle is not attached to this session");l.webrtcState(!1,e.reason),l.hangup()}else if("detached"===e.janus){if(h.debug("Got a detached event on session "+k),h.debug(e),!(d=e.sender))return void h.warn("Missing sender...");if(!(l=T[d]))return;l.detached=!0,l.ondetached(),l.detach()}else if("media"===e.janus){if(h.debug("Got a media event on session "+k),h.debug(e),!(d=e.sender))return void h.warn("Missing sender...");if(!(l=T[d]))return void h.debug("This handle is not attached to this session");l.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(h.debug("Got a slowlink event on session "+k),h.debug(e),!(d=e.sender))return void h.warn("Missing sender...");if(!(l=T[d]))return void h.debug("This handle is not attached to this session");l.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var a,s;if(h.error("Ooops: "+e.error.code+" "+e.error.reason),h.debug(e),a=e.transaction)(s=A[a])&&s(e),delete A[a];return}if("event"===e.janus){var d;if(h.debug("Got a plugin event on session "+k),h.debug(e),!(d=e.sender))return void h.warn("Missing sender...");var c=e.plugindata;if(!c)return void h.warn("Missing plugindata...");h.debug("  -- Event is coming from "+d+" ("+c.plugin+")");var l,u=c.data;if(h.debug(u),!(l=T[d]))return void h.warn("This handle is not attached to this session");var f=e.jsep;f&&(h.debug("Handling SDP as well..."),h.debug(f));var v=l.onmessage;v?(h.debug("Notifying application..."),v(u,f)):h.debug("No provided notification callback")}else{if("timeout"===e.janus)return h.error("Timeout on session "+k),h.debug(e),void(r&&n.close(3504,"Gateway timeout"));h.warn("Unknown message/event  '"+e.janus+"' on session "+k),h.debug(e)}}}else h.debug("Got a success on session "+k),h.debug(e),(a=e.transaction)&&((s=A[a])&&s(e),delete A[a]);else h.debug("Got an ack on session "+k),h.debug(e),(a=e.transaction)&&((s=A[a])&&s(e),delete A[a]);else h.debug("Got info on the Janus instance"),h.debug(e),(a=e.transaction)&&((s=A[a])&&s(e),delete A[a]);else h.vdebug("Got a keepalive on session "+k);else for(var g=0;g<e.length;g++)j(e[g],!0)}function x(){if(s&&r&&y){t=setTimeout(x,b);var e={janus:"keepalive",session_id:k,transaction:h.randomString(12)};m&&(e.token=m),p&&(e.apisecret=p),n.send(JSON.stringify(e))}}function I(d){var c=h.randomString(12),l={janus:"create",transaction:c};if(d.reconnect&&(y=!1,l.janus="claim",l.session_id=k,n&&(n.onopen=null,n.onerror=null,n.onclose=null,t&&(clearTimeout(t),t=null))),m&&(l.token=m),p&&(l.apisecret=p),!s&&h.isArray(i)&&(0===(s=i[a]).indexOf("ws")?(r=!0,h.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(r=!1,h.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),r)for(var u in n=h.newWebSocket(s,"janus-protocol"),o={error:function(){if(h.error("Error connecting to the Janus WebSockets server... "+s),h.isArray(i)&&!d.reconnect)return++a===i.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){I(d)}),200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){A[c]=function(e){if(h.debug(e),"success"!==e.janus)return h.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);t=setTimeout(x,b),y=!0,k=e.session_id?e.session_id:e.data.id,d.reconnect?h.log("Claimed session: "+k):h.log("Created session: "+k),h.sessions[k]=C,d.success()},n.send(JSON.stringify(l))},message:function(e){j(JSON.parse(e.data))},close:function(){s&&y&&(y=!1,e.error("Lost connection to the server (is it down?)"))}})n.addEventListener(u,o[u]);else h.httpAPICall(s,{verb:"POST",withCredentials:f,body:l,success:function(e){if(h.debug(e),"success"!==e.janus)return h.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);y=!0,k=e.session_id?e.session_id:e.data.id,d.reconnect?h.log("Claimed session: "+k):h.log("Created session: "+k),h.sessions[k]=C,R(),d.success()},error:function(e,r){if(h.error(e+":",r),h.isArray(i)&&!d.reconnect)return++a===i.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){I(d)}),200));""===r?d.error(e+": Is the server down?"):d.error(e+": "+r)}})}function O(e,o){if((o=o||{}).success="function"==typeof o.success?o.success:h.noop,o.error="function"==typeof o.error?o.error:h.noop,!y)return h.warn("Is the server down? (connected=false)"),void o.error("Is the server down? (connected=false)");var t=T[e];if(!t||!t.webrtcStuff)return h.warn("Invalid handle"),void o.error("Invalid handle");var i=o.message,a=o.jsep,d=h.randomString(12),c={janus:"message",body:i,transaction:d};if(t.token&&(c.token=t.token),p&&(c.apisecret=p),a&&(c.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(c.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(c.jsep.rid_order=a.rid_order)),h.debug("Sending message to plugin (handle="+e+"):"),h.debug(c),r)return c.session_id=k,c.handle_id=e,A[d]=function(e){if(h.debug("Message sent!"),h.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return h.warn("Request succeeded, but missing plugindata..."),void o.success();h.log("Synchronous transaction successful ("+r.plugin+")");var n=r.data;return h.debug(n),void o.success(n)}"ack"===e.janus?o.success():e.error?(h.error("Ooops: "+e.error.code+" "+e.error.reason),o.error(e.error.code+" "+e.error.reason)):(h.error("Unknown error"),o.error("Unknown error"))},void n.send(JSON.stringify(c));h.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:c,success:function(e){if(h.debug("Message sent!"),h.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return h.warn("Request succeeded, but missing plugindata..."),void o.success();h.log("Synchronous transaction successful ("+r.plugin+")");var n=r.data;return h.debug(n),void o.success(n)}"ack"===e.janus?o.success():e.error?(h.error("Ooops: "+e.error.code+" "+e.error.reason),o.error(e.error.code+" "+e.error.reason)):(h.error("Unknown error"),o.error("Unknown error"))},error:function(e,r){h.error(e+":",r),o.error(e+": "+r)}})}function P(e,o){if(y){var t=T[e];if(t&&t.webrtcStuff){var i={janus:"trickle",candidate:o,transaction:h.randomString(12)};if(t.token&&(i.token=t.token),p&&(i.apisecret=p),h.vdebug("Sending trickle candidate (handle="+e+"):"),h.vdebug(i),r)return i.session_id=k,i.handle_id=e,void n.send(JSON.stringify(i));h.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:i,success:function(e){h.vdebug("Candidate sent!"),h.vdebug(e),"ack"===e.janus||h.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,r){h.error(e+":",r)}})}else h.warn("Invalid handle")}else h.warn("Is the server down? (connected=false)")}function V(e,r,n,o,t){var i=T[e];if(i&&i.webrtcStuff){var a=i.webrtcStuff;if(a.pc){var s=function(e){h.log("Received state change on data channel:",e);var r=e.target.label,n=e.target.protocol,o=a.dataChannel[r]?a.dataChannel[r].readyState:"null";if(h.log("State change on <"+r+"> data channel: "+o),"open"===o){if(a.dataChannel[r].pending&&a.dataChannel[r].pending.length>0){h.log("Sending pending messages on <"+r+">:",a.dataChannel[r].pending.length);var t,s=Object(g.a)(a.dataChannel[r].pending);try{for(s.s();!(t=s.n()).done;){var d=t.value;h.log("Sending data on data channel <"+r+">"),h.debug(d),a.dataChannel[r].send(d)}}catch(c){s.e(c)}finally{s.f()}a.dataChannel[r].pending=[]}i.ondataopen(r,n)}};if(o)a.dataChannel[r]=o;else{var d={ordered:!0};n&&(d.protocol=n),a.dataChannel[r]=a.pc.createDataChannel(r,d)}a.dataChannel[r].onmessage=function(e){h.log("Received message on data channel:",e);var r=e.target.label;i.ondata(e.data,r)},a.dataChannel[r].onopen=s,a.dataChannel[r].onclose=s,a.dataChannel[r].onerror=function(e){h.error("Got error on data channel:",e)},a.dataChannel[r].pending=[],t&&a.dataChannel[r].pending.push(t)}else h.warn("Invalid PeerConnection")}else h.warn("Invalid handle")}function E(e,r){(r=r||{}).success="function"==typeof r.success?r.success:h.noop,r.error="function"==typeof r.error?r.error:h.noop;var n=T[e];if(!n||!n.webrtcStuff)return h.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,t=r.text||r.data;if(!t)return h.warn("Invalid data"),void r.error("Invalid data");var i=r.label?r.label:h.dataChanDefaultLabel;return o.dataChannel[i]?"open"!==o.dataChannel[i].readyState?(o.dataChannel[i].pending.push(t),void r.success()):(h.log("Sending data on data channel <"+i+">"),h.debug(t),o.dataChannel[i].send(t),void r.success()):(V(e,i,r.protocol,!1,t,r.protocol),void r.success())}function M(e,r){(r=r||{}).success="function"==typeof r.success?r.success:h.noop,r.error="function"==typeof r.error?r.error:h.noop;var n=T[e];if(!n||!n.webrtcStuff)return h.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff;if(!o.dtmfSender){if(o.pc){var t=o.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!t)return h.warn("Invalid DTMF configuration (no audio track)"),void r.error("Invalid DTMF configuration (no audio track)");o.dtmfSender=t.dtmf,o.dtmfSender&&(h.log("Created DTMF Sender"),o.dtmfSender.ontonechange=function(e){h.debug("Sent DTMF tone: "+e.tone)})}if(!o.dtmfSender)return h.warn("Invalid DTMF configuration"),void r.error("Invalid DTMF configuration")}var i=r.dtmf;if(!i)return h.warn("Invalid DTMF parameters"),void r.error("Invalid DTMF parameters");var a=i.tones;if(!a)return h.warn("Invalid DTMF string"),void r.error("Invalid DTMF string");var s="number"===typeof i.duration?i.duration:500,d="number"===typeof i.gap?i.gap:50;h.debug("Sending DTMF string "+a+" (duration "+s+"ms, gap "+d+"ms)"),o.dtmfSender.insertDTMF(a,s,d),r.success()}function N(e,o){(o=o||{}).success="function"==typeof o.success?o.success:h.noop,o.error="function"==typeof o.error?o.error:h.noop;var t=!0===o.noRequest;h.log("Destroying handle "+e+" (only-locally="+t+")"),q(e);var i=T[e];if(!i||i.detached)return delete T[e],void o.success();if(t)return delete T[e],void o.success();if(!y)return h.warn("Is the server down? (connected=false)"),void o.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:h.randomString(12)};if(i.token&&(a.token=i.token),p&&(a.apisecret=p),r)return a.session_id=k,a.handle_id=e,n.send(JSON.stringify(a)),delete T[e],void o.success();h.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:a,success:function(r){h.log("Destroyed handle:"),h.debug(r),"success"!==r.janus&&h.error("Ooops: "+r.error.code+" "+r.error.reason),delete T[e],o.success()},error:function(r,n){h.error(r+":",n),delete T[e],o.success()}})}function L(e,r,n,o,t){var i=T[e];if(!i||!i.webrtcStuff)return h.warn("Invalid handle"),o.stream||h.stopAllTracks(t),void o.error("Invalid handle");var a=i.webrtcStuff;h.debug("streamsDone:",t),t&&(h.debug("  -- Audio tracks:",t.getAudioTracks()),h.debug("  -- Video tracks:",t.getVideoTracks()));var s=!1;if(a.myStream&&n.update&&!a.streamExternal){if((!n.update&&z(n)||n.update&&(n.addAudio||n.replaceAudio))&&t.getAudioTracks()&&t.getAudioTracks().length)if(a.myStream.addTrack(t.getAudioTracks()[0]),h.unifiedPlan){h.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",t.getAudioTracks()[0]);var f=null;if((p=a.pc.getTransceivers())&&p.length>0){var v,m=Object(g.a)(p);try{for(m.s();!(v=m.n()).done;){if((k=v.value).sender&&k.sender.track&&"audio"===k.sender.track.kind||k.receiver&&k.receiver.track&&"audio"===k.receiver.track.kind){f=k;break}}}catch(j){m.e(j)}finally{m.f()}}f&&f.sender?f.sender.replaceTrack(t.getAudioTracks()[0]):a.pc.addTrack(t.getAudioTracks()[0],t)}else h.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",t.getAudioTracks()[0]),a.pc.addTrack(t.getAudioTracks()[0],t);if((!n.update&&Y(n)||n.update&&(n.addVideo||n.replaceVideo))&&t.getVideoTracks()&&t.getVideoTracks().length)if(a.myStream.addTrack(t.getVideoTracks()[0]),h.unifiedPlan){h.log((n.replaceVideo?"Replacing":"Adding")+" video track:",t.getVideoTracks()[0]);var p,b=null;if((p=a.pc.getTransceivers())&&p.length>0){var w,y=Object(g.a)(p);try{for(y.s();!(w=y.n()).done;){var k;if((k=w.value).sender&&k.sender.track&&"video"===k.sender.track.kind||k.receiver&&k.receiver.track&&"video"===k.receiver.track.kind){b=k;break}}}catch(j){y.e(j)}finally{y.f()}}b&&b.sender?b.sender.replaceTrack(t.getVideoTracks()[0]):a.pc.addTrack(t.getVideoTracks()[0],t)}else h.log((n.replaceVideo?"Replacing":"Adding")+" video track:",t.getVideoTracks()[0]),a.pc.addTrack(t.getVideoTracks()[0],t)}else a.myStream=t,s=!0;if(!a.pc){var C={iceServers:d,iceTransportPolicy:c,bundlePolicy:l};"chrome"===h.webRTCAdapter.browserDetails.browser&&(C.sdpSemantics=h.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var D={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&D.optional.push({googIPv6:!0}),o.rtcConstraints&&"object"===typeof o.rtcConstraints)for(var A in h.debug("Adding custom PeerConnection constraints:",o.rtcConstraints),o.rtcConstraints)D.optional.push(o.rtcConstraints[A]);"edge"===h.webRTCAdapter.browserDetails.browser&&(C.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(o.senderTransforms||o.receiverTransforms)&&(a.senderTransforms=o.senderTransforms,a.receiverTransforms=o.receiverTransforms,C.forceEncodedAudioInsertableStreams=!0,C.forceEncodedVideoInsertableStreams=!0,C.encodedInsertableStreams=!0),h.log("Creating PeerConnection"),h.debug(D),a.pc=new RTCPeerConnection(C,D),h.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),h.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(r){if(!r.candidate||"edge"===h.webRTCAdapter.browserDetails.browser&&r.candidate.candidate.indexOf("endOfCandidates")>0)h.log("End of candidates."),a.iceDone=!0,!0===a.trickle?P(e,{completed:!0}):function(e,r){(r=r||{}).success="function"==typeof r.success?r.success:h.noop,r.error="function"==typeof r.error?r.error:h.noop;var n=T[e];if(!n||!n.webrtcStuff)return void h.warn("Invalid handle, not sending anything");var o=n.webrtcStuff;if(h.log("Sending offer/answer SDP..."),!o.mySdp)return void h.warn("Local SDP instance is invalid, not sending anything...");o.mySdp={type:o.pc.localDescription.type,sdp:o.pc.localDescription.sdp},!1===o.trickle&&(o.mySdp.trickle=!1);h.debug(r),o.sdpSent=!0,r.success(o.mySdp)}(e,o);else{var n={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===a.trickle&&P(e,n)}},a.pc.ontrack=function(e){if(h.log("Handling Remote Track"),h.debug(e),e.streams&&(a.remoteStream=e.streams[0],i.onremotestream(a.remoteStream),!e.track.onended)){if(a.receiverTransforms){var r=null;RTCRtpSender.prototype.createEncodedStreams?r=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms.audio?r=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms.video&&(r=e.receiver.createEncodedVideoStreams())),r&&(console.log(r),r.readableStream&&r.writableStream?r.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(r.writableStream):r.readable&&r.writable&&r.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(r.writable))}var n=null;h.log("Adding onended callback to track:",e.track),e.track.onended=function(e){h.log("Remote track removed:",e),a.remoteStream&&(clearTimeout(n),a.remoteStream.removeTrack(e.target),i.onremotestream(a.remoteStream))},e.track.onmute=function(e){h.log("Remote track muted:",e),a.remoteStream&&null==n&&(n=setTimeout((function(){h.log("Removing remote track"),a.remoteStream&&(a.remoteStream.removeTrack(e.target),i.onremotestream(a.remoteStream)),n=null}),2520))},e.track.onunmute=function(e){if(h.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{a.remoteStream.addTrack(e.target),i.onremotestream(a.remoteStream)}catch(r){h.error(r)}}}}}if(s&&t){h.log("Adding local stream");var R=!0===o.simulcast2;t.getTracks().forEach((function(e){h.log("Adding local track:",e);var r=null;if(R&&"audio"!==e.kind){h.log("Enabling rid-based simulcasting:",e);var n=S(o.simulcastMaxBitrates),i=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[t],sendEncodings:o.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]});i&&(r=i.sender)}else r=a.pc.addTrack(e,t);if(r&&a.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=r.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===r.track.kind&&a.senderTransforms.audio?s=r.createEncodedAudioStreams():"video"===r.track.kind&&a.senderTransforms.video&&(s=r.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(a.senderTransforms[r.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(a.senderTransforms[r.track.kind]).pipeTo(s.writable))}}))}(function(e){if(h.debug("isDataEnabled:",e),"edge"===h.webRTCAdapter.browserDetails.browser)return h.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(n)&&!a.dataChannel[h.dataChanDefaultLabel]&&(h.log("Creating default data channel"),V(e,h.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(r){h.log("Data channel created by Janus:",r),V(e,r.channel.label,r.channel.protocol,r.channel)}),a.myStream&&i.onlocalstream(a.myStream),r?a.pc.setRemoteDescription(r).then((function(){if(h.log("Remote description accepted!"),a.remoteSdp=r.sdp,a.candidates&&a.candidates.length>0){for(var t=0;t<a.candidates.length;t++){var i=a.candidates[t];h.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(h.endOfCandidates)}a.candidates=[]}!function(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:h.noop,n.error="function"==typeof n.error?n.error:h.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:h.noop;var o=T[e];if(!o||!o.webrtcStuff)return h.warn("Invalid handle"),void n.error("Invalid handle");var t=o.webrtcStuff,i=!0===n.simulcast;i?h.log("Creating answer (iceDone="+t.iceDone+", simulcast="+i+")"):h.log("Creating answer (iceDone="+t.iceDone+")");var a=null;if(h.unifiedPlan){a={};var s=null,d=null,c=t.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(g.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(j){u.e(j)}finally{u.f()}}var v=z(r),m=H(r);if(v||m){if(v&&m){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",h.log("Setting audio transceiver to sendrecv:",s)}catch(D){h.error(D)}}else if(v&&!m)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",h.log("Setting audio transceiver to sendonly:",s))}catch(D){h.error(D)}else if(!v&&m)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",h.log("Setting audio transceiver to recvonly:",s)}catch(D){h.error(D)}else s=t.pc.addTransceiver("audio",{direction:"recvonly"}),h.log("Adding recvonly audio transceiver:",s)}else if(r.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",h.log("Setting audio transceiver to inactive:",s)}catch(D){h.error(D)}var p=Y(r),b=K(r);if(p||b){if(p&&b){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",h.log("Setting video transceiver to sendrecv:",d)}catch(D){h.error(D)}}else if(p&&!b){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",h.log("Setting video transceiver to sendonly:",d)}catch(D){h.error(D)}}else if(!p&&b)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",h.log("Setting video transceiver to recvonly:",d)}catch(D){h.error(D)}else d=t.pc.addTransceiver("video",{direction:"recvonly"}),h.log("Adding recvonly video transceiver:",d)}else if(r.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",h.log("Setting video transceiver to inactive:",d)}catch(D){h.error(D)}}else a="firefox"===h.webRTCAdapter.browserDetails.browser||"edge"===h.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:H(r),offerToReceiveVideo:K(r)}:{mandatory:{OfferToReceiveAudio:H(r),OfferToReceiveVideo:K(r)}};h.debug(a);var w=Y(r);if(w&&i&&"firefox"===h.webRTCAdapter.browserDetails.browser){h.log("Enabling Simulcasting for Firefox (RID)");var y=t.pc.getSenders()[1];h.log(y);var k=y.getParameters();h.log(k);var C=S(n.simulcastMaxBitrates);y.setParameters({encodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}]})}t.pc.createAnswer(a).then((function(e){h.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,h.log("Setting local description"),w&&i&&("chrome"===h.webRTCAdapter.browserDetails.browser?h.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==h.webRTCAdapter.browserDetails.browser&&h.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),t.mySdp=e.sdp,t.pc.setLocalDescription(e).catch(n.error),t.mediaConstraints=a,t.iceDone||t.trickle?((t.senderTransforms||t.receiverTransforms)&&(e.e2ee=!0),n.success(e)):h.log("Waiting for all candidates...")}),n.error)}(e,n,o)}),o.error):function(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:h.noop,n.error="function"==typeof n.error?n.error:h.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:h.noop;var o=T[e];if(!o||!o.webrtcStuff)return h.warn("Invalid handle"),void n.error("Invalid handle");var t=o.webrtcStuff,i=!0===n.simulcast;i?h.log("Creating offer (iceDone="+t.iceDone+", simulcast="+i+")"):h.log("Creating offer (iceDone="+t.iceDone+")");var a={};if(h.unifiedPlan){var s=null,d=null,c=t.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(g.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(j){u.e(j)}finally{u.f()}}var v=z(r),m=H(r);v||m?v&&m?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",h.log("Setting audio transceiver to sendrecv:",s)):v&&!m?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",h.log("Setting audio transceiver to sendonly:",s)):!v&&m&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",h.log("Setting audio transceiver to recvonly:",s)):(s=t.pc.addTransceiver("audio",{direction:"recvonly"}),h.log("Adding recvonly audio transceiver:",s))):r.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",h.log("Setting audio transceiver to inactive:",s));var p=Y(r),b=K(r);p||b?p&&b?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",h.log("Setting video transceiver to sendrecv:",d)):p&&!b?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",h.log("Setting video transceiver to sendonly:",d)):!p&&b&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",h.log("Setting video transceiver to recvonly:",d)):(d=t.pc.addTransceiver("video",{direction:"recvonly"}),h.log("Adding recvonly video transceiver:",d))):r.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",h.log("Setting video transceiver to inactive:",d))}else a.offerToReceiveAudio=H(r),a.offerToReceiveVideo=K(r);!0===n.iceRestart&&(a.iceRestart=!0);h.debug(a);var w=Y(r);if(w&&i&&"firefox"===h.webRTCAdapter.browserDetails.browser){h.log("Enabling Simulcasting for Firefox (RID)");var y=t.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(y){var k=y.getParameters();k||(k={});var C=S(n.simulcastMaxBitrates);k.encodings=n.sendEncodings||[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],y.setParameters(k)}}t.pc.createOffer(a).then((function(e){h.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,h.log("Setting local description"),w&&i&&("chrome"===h.webRTCAdapter.browserDetails.browser||"safari"===h.webRTCAdapter.browserDetails.browser?(h.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var r=e.split("\r\n"),n=!1,o=[-1],t=[-1],i=null,a=null,s=null,d=null,c=-1,l=0;l<r.length;l++){if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(o[0]<0)){c=l;break}n=!0}else if(o[0]>-1){c=l;break}}else if(n){var u=r[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)o[0]=u[1],t[0]=u[2],r.splice(l,1),l--;else{if(o[0]){if((g=r[l].match("a=ssrc:"+o[0]+" cname:(.+)"))&&(i=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" msid:(.+)"))&&(a=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" mslabel:(.+)"))&&(s=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" label:(.+)"))&&(d=g[1]),0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}}0!=r[l].length||(r.splice(l,1),l--)}}}if(o[0]<0){c=-1,n=!1;for(l=0;l<r.length;l++){var f;if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(o[0]<0)){c=l;break}n=!0}else if(o[0]>-1){c=l;break}}else if(n){if(o[0]<0){var v=r[l].match(/a=ssrc:(\d+)/);if(v){o[0]=v[1],r.splice(l,1),l--;continue}}else{var g;if((g=r[l].match("a=ssrc:"+o[0]+" cname:(.+)"))&&(i=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" msid:(.+)"))&&(a=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" mslabel:(.+)"))&&(s=g[1]),(g=r[l].match("a=ssrc:"+o[0]+" label:(.+)"))&&(d=g[1]),0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}}0!==r[l].length||(r.splice(l,1),l--)}}}if(o[0]<0)return h.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=r.length);o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random()),t[1]=Math.floor(4294967295*Math.random()),t[2]=Math.floor(4294967295*Math.random());for(l=0;l<o.length;l++)i&&(r.splice(c,0,"a=ssrc:"+o[l]+" cname:"+i),c++),a&&(r.splice(c,0,"a=ssrc:"+o[l]+" msid:"+a),c++),s&&(r.splice(c,0,"a=ssrc:"+o[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+o[l]+" label:"+d),c++),i&&(r.splice(c,0,"a=ssrc:"+t[l]+" cname:"+i),c++),a&&(r.splice(c,0,"a=ssrc:"+t[l]+" msid:"+a),c++),s&&(r.splice(c,0,"a=ssrc:"+t[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+t[l]+" label:"+d),c++);r.splice(c,0,"a=ssrc-group:FID "+o[2]+" "+t[2]),r.splice(c,0,"a=ssrc-group:FID "+o[1]+" "+t[1]),r.splice(c,0,"a=ssrc-group:FID "+o[0]+" "+t[0]),r.splice(c,0,"a=ssrc-group:SIM "+o[0]+" "+o[1]+" "+o[2]),(e=r.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==h.webRTCAdapter.browserDetails.browser&&h.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),t.mySdp=e.sdp,t.pc.setLocalDescription(e).catch(n.error),t.mediaConstraints=a,t.iceDone||t.trickle?((t.senderTransforms||t.receiverTransforms)&&(e.e2ee=!0),n.success(e)):h.log("Waiting for all candidates...")}),n.error)}(e,n,o)}function J(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:h.noop,n.error="function"==typeof n.error?n.error:B;var o=n.jsep;if(r&&o)return h.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!r&&(!o||!o.type||!o.sdp))return h.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media="object"===typeof n.media&&n.media?n.media:{audio:!0,video:!0};var t=n.media,i=T[e];if(!i||!i.webrtcStuff)return h.warn("Invalid handle"),void n.error("Invalid handle");var a,s=i.webrtcStuff;if(s.trickle=(a=n.trickle,h.debug("isTrickleEnabled:",a),!1!==a),s.pc){if(h.log("Updating existing media session"),t.update=!0,n.stream)n.stream!==s.myStream&&h.log("Renegotiation involves a new external stream");else{if(t.addAudio){if(t.keepAudio=!1,t.replaceAudio=!1,t.removeAudio=!1,t.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return h.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else t.removeAudio?(t.keepAudio=!1,t.replaceAudio=!1,t.addAudio=!1,t.audioSend=!1):t.replaceAudio&&(t.keepAudio=!1,t.addAudio=!1,t.removeAudio=!1,t.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(t)||t.removeAudio||t.replaceAudio||(t.keepAudio=!0):(t.replaceAudio&&(t.keepAudio=!1,t.replaceAudio=!1,t.addAudio=!0,t.audioSend=!0),z(t)&&(t.keepAudio=!1,t.addAudio=!0)),t.addVideo){if(t.keepVideo=!1,t.replaceVideo=!1,t.removeVideo=!1,t.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return h.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else t.removeVideo?(t.keepVideo=!1,t.replaceVideo=!1,t.addVideo=!1,t.videoSend=!1):t.replaceVideo&&(t.keepVideo=!1,t.addVideo=!1,t.removeVideo=!1,t.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!Y(t)||t.removeVideo||t.replaceVideo||(t.keepVideo=!0):(t.replaceVideo&&(t.keepVideo=!1,t.replaceVideo=!1,t.addVideo=!0,t.videoSend=!0),Y(t)&&(t.keepVideo=!1,t.addVideo=!0)),t.addData&&(t.data=!0)}if(z(t)&&t.keepAudio&&Y(t)&&t.keepVideo)return i.consentDialog(!1),void L(e,o,t,n,s.myStream)}else t.update=!1,t.keepAudio=!1,t.keepVideo=!1;if(t.update&&!s.streamExternal){if(t.removeAudio||t.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var d=s.myStream.getAudioTracks()[0];h.log("Removing audio track:",d),s.myStream.removeTrack(d);try{d.stop()}catch(E){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var c=!0;if(t.replaceAudio&&h.unifiedPlan&&(c=!1),c){var l,u=Object(g.a)(s.pc.getSenders());try{for(u.s();!(l=u.n()).done;){var f=l.value;f&&f.track&&"audio"===f.track.kind&&(h.log("Removing audio sender:",f),s.pc.removeTrack(f))}}catch(M){u.e(M)}finally{u.f()}}}}if(t.removeVideo||t.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var v=s.myStream.getVideoTracks()[0];h.log("Removing video track:",v),s.myStream.removeTrack(v);try{v.stop()}catch(E){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var m=!0;if(t.replaceVideo&&h.unifiedPlan&&(m=!1),m){var p,b=Object(g.a)(s.pc.getSenders());try{for(b.s();!(p=b.n()).done;){var w=p.value;w&&w.track&&"video"===w.track.kind&&(h.log("Removing video sender:",w),s.pc.removeTrack(w))}}catch(M){b.e(M)}finally{b.f()}}}}}if(n.stream){var S=n.stream;return h.log("MediaStream provided by the application"),h.debug(S),t.update&&s.myStream&&s.myStream!==n.stream&&!s.streamExternal&&(h.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,i.consentDialog(!1),void L(e,o,t,n,S)}if(z(t)||Y(t)){if(!h.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var y={mandatory:{},optional:[]};i.consentDialog(!0);var k=z(t);k&&t&&"object"===typeof t.audio&&(k=t.audio);var C=Y(t);if(C&&t){var D=!0===n.simulcast,A=!0===n.simulcast2;if(!D&&!A||o||t.video||(t.video="hires"),t.video&&"screen"!=t.video&&"window"!=t.video)if("object"===typeof t.video)C=t.video;else{var R=0,j=0;"lowres"===t.video?(j=240,240,R=320):"lowres-16:9"===t.video?(j=180,180,R=320):"hires"===t.video||"hires-16:9"===t.video||"hdres"===t.video?(j=720,720,R=1280):"fhdres"===t.video?(j=1080,1080,R=1920):"4kres"===t.video?(j=2160,2160,R=3840):"stdres"===t.video?(j=480,480,R=640):"stdres-16:9"===t.video?(j=360,360,R=640):(h.log("Default video setting is stdres 4:3"),j=480,480,R=640),h.log("Adding media constraint:",t.video),C={height:{ideal:j},width:{ideal:R}},h.log("Adding video constraint:",C)}else if("screen"===t.video||"window"===t.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return y.video={},t.screenshareFrameRate&&(y.video.frameRate=t.screenshareFrameRate),t.screenshareHeight&&(y.video.height=t.screenshareHeight),t.screenshareWidth&&(y.video.width=t.screenshareWidth),y.audio=t.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(y).then((function(r){i.consentDialog(!1),z(t)&&!t.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){r.addTrack(i.getAudioTracks()[0]),L(e,o,t,n,r)})):L(e,o,t,n,r)}),(function(e){i.consentDialog(!1),n.error(e)}));function x(r,a){i.consentDialog(!1),r?n.error(r):L(e,o,t,n,a)}function I(e,r,n){h.log("Adding media constraint (screen capture)"),h.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),r(null,e)})):r(null,e)})).catch((function(e){i.consentDialog(!1),r(e)}))}if("chrome"===h.webRTCAdapter.browserDetails.browser){var O=h.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),O>=26&&O<=P?I(y={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:t.screenshareFrameRate,maxFrameRate:t.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(t)&&!t.keepAudio},x):h.extension.getScreen((function(e,r){if(e)return i.consentDialog(!1),n.error(e);(y={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:t.screenshareFrameRate,maxFrameRate:t.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=r,I(y,x,z(t)&&!t.keepAudio)}))}else if("firefox"===h.webRTCAdapter.browserDetails.browser){if(!(h.webRTCAdapter.browserDetails.version>=33)){var V=new Error("NavigatorUserMediaError");return V.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void n.error(V)}I(y={video:{mozMediaSource:t.video,mediaSource:t.video},audio:z(t)&&!t.keepAudio},(function(e,r){if(x(e,r),!e)var n=r.currentTime,o=window.setInterval((function(){r||window.clearInterval(o),r.currentTime==n&&(window.clearInterval(o),r.onended&&r.onended()),n=r.currentTime}),500)}))}return}}t&&"screen"===t.video||navigator.mediaDevices.enumerateDevices().then((function(r){var a=r.some((function(e){return"audioinput"===e.kind})),s=function(e){if(h.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var r=e.video.mandatory;if(r.chromeMediaSource)return"desktop"===r.chromeMediaSource||"screen"===r.chromeMediaSource;if(r.mozMediaSource)return"window"===r.mozMediaSource||"screen"===r.mozMediaSource;if(r.mediaSource)return"window"===r.mediaSource||"screen"===r.mediaSource;return!1}(t)||r.some((function(e){return"videoinput"===e.kind})),d=z(t),c=Y(t),l=function(e){return h.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(t),u=function(e){return h.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(t);if(d||c||l||u){var f=!!d&&a,v=!!c&&s;if(!f&&!v)return i.consentDialog(!1),n.error("No capture device found"),!1;if(!f&&l)return i.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!v&&u)return i.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var g={audio:!(!a||t.keepAudio)&&k,video:!(!s||t.keepVideo)&&C};h.debug("getUserMedia constraints",g),g.audio||g.video?navigator.mediaDevices.getUserMedia(g).then((function(r){i.consentDialog(!1),L(e,o,t,n,r)})).catch((function(e){i.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),L(e,o,t,n,S))})).catch((function(e){i.consentDialog(!1),n.error(e)}))}else L(e,o,t,n)}function F(e,r){(r=r||{}).success="function"==typeof r.success?r.success:h.noop,r.error="function"==typeof r.error?r.error:B;var n=r.jsep,o=T[e];if(!o||!o.webrtcStuff)return h.warn("Invalid handle"),void r.error("Invalid handle");var t=o.webrtcStuff;if(n){if(!t.pc)return h.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void r.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.pc.setRemoteDescription(n).then((function(){if(h.log("Remote description accepted!"),t.remoteSdp=n.sdp,t.candidates&&t.candidates.length>0){for(var e=0;e<t.candidates.length;e++){var o=t.candidates[e];h.debug("Adding remote candidate:",o),o&&!0!==o.completed?t.pc.addIceCandidate(o):t.pc.addIceCandidate(h.endOfCandidates)}t.candidates=[]}r.success()}),r.error)}else r.error("Invalid JSEP")}function _(e,r){var n=T[e];if(!n||!n.webrtcStuff)return h.warn("Invalid handle"),0;var o=r?"remote":"local",t=n.webrtcStuff;return t.volume[o]||(t.volume[o]={value:0}),!t.pc.getStats||"chrome"!==h.webRTCAdapter.browserDetails.browser&&"safari"!==h.webRTCAdapter.browserDetails.browser?(h.warn("Getting the "+o+" volume unsupported by browser"),0):r&&!t.remoteStream?(h.warn("Remote stream unavailable"),0):r||t.myStream?t.volume[o].timer?t.volume[o].value:(h.log("Starting "+o+" volume monitor"),t.volume[o].timer=setInterval((function(){t.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||(t.volume[o].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(h.warn("Local stream unavailable"),0)}function U(e,r){var n=T[e];if(!n||!n.webrtcStuff)return h.warn("Invalid handle"),!0;var o=n.webrtcStuff;return o.pc?o.myStream?r?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?!o.myStream.getVideoTracks()[0].enabled:(h.warn("No video track"),!0):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?!o.myStream.getAudioTracks()[0].enabled:(h.warn("No audio track"),!0):(h.warn("Invalid local MediaStream"),!0):(h.warn("Invalid PeerConnection"),!0)}function W(e,r,n){var o=T[e];if(!o||!o.webrtcStuff)return h.warn("Invalid handle"),!1;var t=o.webrtcStuff;return t.pc?t.myStream?r?t.myStream.getVideoTracks()&&0!==t.myStream.getVideoTracks().length?(t.myStream.getVideoTracks()[0].enabled=!n,!0):(h.warn("No video track"),!1):t.myStream.getAudioTracks()&&0!==t.myStream.getAudioTracks().length?(t.myStream.getAudioTracks()[0].enabled=!n,!0):(h.warn("No audio track"),!1):(h.warn("Invalid local MediaStream"),!1):(h.warn("Invalid PeerConnection"),!1)}function G(e){var r=T[e];if(!r||!r.webrtcStuff)return h.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;return n.pc?n.pc.getStats?n.bitrate.timer?n.bitrate.value:(h.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var r=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?r=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(r=!0),r)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var o=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"===h.webRTCAdapter.browserDetails.browser&&(o/=1e3);var t=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/o);"safari"===h.webRTCAdapter.browserDetails.browser&&(t=parseInt(t/1e3)),n.bitrate.value=t+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(h.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function B(e){h.error("WebRTC error:",e)}function q(e,o){h.log("Cleaning WebRTC stuff");var t=T[e];if(t){var i=t.webrtcStuff;if(i){if(!0===o){var a={janus:"hangup",transaction:h.randomString(12)};t.token&&(a.token=t.token),p&&(a.apisecret=p),h.debug("Sending hangup request (handle="+e+"):"),h.debug(a),r?(a.session_id=k,a.handle_id=e,n.send(JSON.stringify(a))):h.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:a})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null,!i.streamExternal&&i.myStream&&(h.log("Stopping local stream tracks"),h.stopAllTracks(i.myStream)),i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(d){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null,i.senderTransforms=null,i.receiverTransforms=null}t.oncleanup()}}function z(e){return h.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function H(e){return h.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Y(e){return h.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return h.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}I(e),this.getServer=function(){return s},this.isConnected=function(){return y},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:h.noop,e.error="function"==typeof e.error?e.error:h.noop,e.reconnect=!0,I(e)},this.getSessionId=function(){return k},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:h.noop,e.error="function"==typeof e.error?e.error:h.noop,h.log("Getting info on Janus instance"),!y)return h.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var o=h.randomString(12),t={janus:"info",transaction:o};m&&(t.token=m);p&&(t.apisecret=p);if(r)return A[o]=function(r){h.log("Server info:"),h.debug(r),"server_info"!==r.janus&&h.error("Ooops: "+r.error.code+" "+r.error.reason),e.success(r)},void n.send(JSON.stringify(t));h.httpAPICall(s,{verb:"POST",withCredentials:f,body:t,success:function(r){h.log("Server info:"),h.debug(r),"server_info"!==r.janus&&h.error("Ooops: "+r.error.code+" "+r.error.reason),e.success(r)},error:function(r,n){h.error(r+":",n),""===n?e.error(r+": Is the server down?"):e.error(r+": "+n)}})}(e)},this.destroy=function(i){!function(i){(i=i||{}).success="function"==typeof i.success?i.success:h.noop,i.error="function"==typeof i.error?i.error:h.noop;var a=!0===i.unload,d=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(d=!0===i.notifyDestroyed);var c=!0===i.cleanupHandles;if(h.log("Destroying session "+k+" (unload="+a+")"),!k)return h.warn("No session to destroy"),i.success(),void(d&&e.destroyed());if(c)for(var l in T)N(l,{noRequest:!0});if(!y)return h.warn("Is the server down? (connected=false)"),k=null,void i.success();var u={janus:"destroy",transaction:h.randomString(12)};m&&(u.token=m);p&&(u.apisecret=p);if(a)return r?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(s+"/"+k,JSON.stringify(u)),h.log("Destroyed session:"),k=null,y=!1,i.success(),void(d&&e.destroyed());if(r){u.session_id=k;var v=function(){for(var e in o)n.removeEventListener(e,o[e]);n.removeEventListener("message",g),n.removeEventListener("error",b),t&&clearTimeout(t),n.close()},g=function(r){var n=JSON.parse(r.data);n.session_id==u.session_id&&n.transaction==u.transaction&&(v(),i.success(),d&&e.destroyed())},b=function(r){v(),i.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return n.addEventListener("message",g),n.addEventListener("error",b),void(1===n.readyState?n.send(JSON.stringify(u)):b())}h.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:u,success:function(r){h.log("Destroyed session:"),h.debug(r),k=null,y=!1,"success"!==r.janus&&h.error("Ooops: "+r.error.code+" "+r.error.reason),i.success(),d&&e.destroyed()},error:function(r,n){h.error(r+":",n),k=null,y=!1,i.success(),d&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:h.noop,e.error="function"==typeof e.error?e.error:h.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:h.noop,e.iceState="function"==typeof e.iceState?e.iceState:h.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:h.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:h.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:h.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:h.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:h.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:h.noop,e.ondata="function"==typeof e.ondata?e.ondata:h.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:h.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:h.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:h.noop,!y)return h.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var o=e.plugin;if(!o)return h.error("Invalid plugin"),void e.error("Invalid plugin");var t=e.opaqueId,i=e.token?e.token:m,a=h.randomString(12),d={janus:"attach",plugin:o,opaque_id:t,transaction:a};i&&(d.token=i);p&&(d.apisecret=p);if(r)return A[a]=function(r){if(h.debug(r),"success"!==r.janus)return h.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var n=r.data.id;h.log("Created handle: "+n);var t={session:C,plugin:o,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return o},getVolume:function(){return _(n,!0)},getRemoteVolume:function(){return _(n,!0)},getLocalVolume:function(){return _(n,!1)},isAudioMuted:function(){return U(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return U(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return G(n)},send:function(e){O(n,e)},data:function(e){E(n,e)},dtmf:function(e){M(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){J(n,!0,e)},createAnswer:function(e){J(n,!1,e)},handleRemoteJsep:function(e){F(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(n,!0===e)},detach:function(e){N(n,e)}};T[n]=t,e.success(t)},d.session_id=k,void n.send(JSON.stringify(d));h.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:d,success:function(r){if(h.debug(r),"success"!==r.janus)return h.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var n=r.data.id;h.log("Created handle: "+n);var t={session:C,plugin:o,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return o},getVolume:function(){return _(n,!0)},getRemoteVolume:function(){return _(n,!0)},getLocalVolume:function(){return _(n,!1)},isAudioMuted:function(){return U(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return U(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return G(n)},send:function(e){O(n,e)},data:function(e){E(n,e)},dtmf:function(e){M(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){J(n,!0,e)},createAnswer:function(e){J(n,!1,e)},handleRemoteJsep:function(e){F(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(n,!0===e)},detach:function(e){N(n,e)}};T[n]=t,e.success(t)},error:function(r,n){h.error(r+":",n),""===n?e.error(r+": Is the server down?"):e.error(r+": "+n)}})}(e)}}h.UseDefaultDependencies=function(e){var r=e&&e.fetch||fetch,n=e&&e.Promise||Promise,o=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new o(e,r)},extension:e&&e.extension||b,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||m.a,httpAPICall:function(e,o){var t={method:o.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===o.verb&&(t.headers["Content-Type"]="application/json"),void 0!==o.withCredentials&&(t.credentials=!0===o.withCredentials?"include":o.withCredentials?o.withCredentials:"omit"),o.body&&(t.body=JSON.stringify(o.body));var i=r(e,t).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(o.timeout){var a=new n((function(e,r){var n=setTimeout((function(){return clearTimeout(n),r({message:"Request timed out",timeout:o.timeout})}),o.timeout)}));i=n.race([i,a])}return i.then((function(e){return e.ok?typeof o.success===typeof h.noop?e.json().then((function(e){o.success(e)})).catch((function(r){return n.reject({message:"Failed to parse response body",error:r,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof o.error===typeof h.noop&&o.error(e.message||"<< internal error >>",e)})),i}}},h.noop=function(){},h.dataChanDefaultLabel="JanusDataChannel",h.endOfCandidates=null,h.stopAllTracks=function(e){try{var r,n=e.getTracks(),o=Object(g.a)(n);try{for(o.s();!(r=o.n()).done;){var t=r.value;h.log(t),t&&t.stop()}}catch(i){o.e(i)}finally{o.f()}}catch(a){}},h.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:h.noop,h.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),h.trace=h.noop,h.debug=h.noop,h.vdebug=h.noop,h.log=h.noop,h.warn=h.noop,h.error=h.noop,!0===e.debug||"all"===e.debug)h.trace=console.trace.bind(console),h.debug=console.debug.bind(console),h.vdebug=console.debug.bind(console),h.log=console.log.bind(console),h.warn=console.warn.bind(console),h.error=console.error.bind(console);else if(Array.isArray(e.debug)){var r,n=Object(g.a)(e.debug);try{for(n.s();!(r=n.n()).done;){var o=r.value;switch(o){case"trace":h.trace=console.trace.bind(console);break;case"debug":h.debug=console.debug.bind(console);break;case"vdebug":h.vdebug=console.debug.bind(console);break;case"log":h.log=console.log.bind(console);break;case"warn":h.warn=console.warn.bind(console);break;case"error":h.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+o+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(f){n.e(f)}finally{n.f()}}h.log("Initializing library");var t=e.dependencies||h.UseDefaultDependencies();h.isArray=t.isArray,h.webRTCAdapter=t.webRTCAdapter,h.httpAPICall=t.httpAPICall,h.newWebSocket=t.newWebSocket,h.extension=t.extension,h.extension.init(),h.listDevices=function(e,r){e="function"==typeof e?e:h.noop,null==r&&(r={audio:!0,video:!0}),h.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(r).then((function(r){navigator.mediaDevices.enumerateDevices().then((function(n){h.debug(n),e(n),h.stopAllTracks(r)}))})).catch((function(r){h.error(r),e([])})):(h.warn("navigator.mediaDevices unavailable"),e([]))},h.attachMediaStream=function(e,r){try{e.srcObject=r}catch(n){try{e.src=URL.createObjectURL(r)}catch(n){h.error("Error attaching stream to element")}}},h.reattachMediaStream=function(e,r){try{e.srcObject=r.srcObject}catch(n){try{e.src=r.src}catch(n){h.error("Error reattaching stream to element")}}};var i=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",a=window["on"+i];if(window.addEventListener(i,(function(e){for(var r in h.log("Closing window"),h.sessions)h.sessions[r]&&h.sessions[r].destroyOnUnload&&(h.log("Destroying session "+r),h.sessions[r].destroy({unload:!0,notifyDestroyed:!1}));a&&"function"==typeof a&&a()})),h.safariVp8=!1,"safari"===h.webRTCAdapter.browserDetails.browser&&h.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var s,d=Object(g.a)(RTCRtpSender.getCapabilities("video").codecs);try{for(d.s();!(s=d.n()).done;){var c=s.value;if(c&&c.mimeType&&"video/vp8"===c.mimeType.toLowerCase()){h.safariVp8=!0;break}}}catch(f){d.e(f)}finally{d.f()}h.safariVp8?h.log("This version of Safari supports VP8"):h.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({});l.createOffer({offerToReceiveVideo:!0}).then((function(e){h.safariVp8=-1!==e.sdp.indexOf("VP8"),h.safariVp8?h.log("This version of Safari supports VP8"):h.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(h.unifiedPlan=!1,"firefox"===h.webRTCAdapter.browserDetails.browser&&h.webRTCAdapter.browserDetails.version>=59)h.unifiedPlan=!0;else if("chrome"===h.webRTCAdapter.browserDetails.browser&&h.webRTCAdapter.browserDetails.version>=72)h.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in p.prototype){var u=new RTCPeerConnection;try{u.addTransceiver("audio"),h.unifiedPlan=!0}catch(v){}u.close()}else h.unifiedPlan=!1;h.initDone=!0,e.callback()}},h.isWebrtcSupported=function(){return!!window.RTCPeerConnection},h.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},h.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",o=0;o<e;o++){var t=Math.floor(Math.random()*r.length);n+=r.substring(t,t+1)}return n};var w=h,S=n(3),y=n.n(S),k=n(43),T=n(44),C=n(45),D=n(1),A=null,R=null,j=1234,x="videoroom-"+w.randomString(12),I=null,O=[],P=null,V=null,E=function(e){Object(u.a)(n,e);var r=Object(f.a)(n);function n(e){return Object(c.a)(this,n),r.call(this,e)}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.startJanusServerRoom()}},{key:"startJanusServerRoom",value:function(){function e(r){R.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:r,videoSend:!0},success:function(e){w.debug("Got publisher SDP!"),w.debug(e);var n={request:"configure",audio:r,video:!0};R.send({message:n,jsep:e})},error:function(n){w.error("WebRTC error:",n),r&&e(!1)}})}function r(e,r,n,o){var t=null;A.attach({plugin:"janus.plugin.videoroom",opaqueId:x,success:function(r){t=r,console.log("Plugin attached! ("+t.getPlugin()+", id="+t.getId()+")"),console.log("  -- This is a subscriber");var n={request:"join",room:j,ptype:"subscriber",feed:e,private_id:I};t.videoCodec=o,t.send({message:n})},error:function(e){w.error("  -- Error attaching plugin...",e)},onmessage:function(e,r){w.debug(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;if(console.log("Event: "+n),n&&"attached"===n){console.log("subscriber created and attached!");for(var o=1;o<6;o++)if(!O[o]){O[o]=t,t.rfindex=o;break}t.rfid=e.id,t.rfdisplay=e.display,console.log("attached",t),w.log("Successfully attached to feed "+t.rfid+" ("+t.rfdisplay+") in room "+e.room),y()("#remote"+t.rfindex).removeClass("hide").html(t.rfdisplay).show()}r&&(w.debug("Handling SDP as well...",r),t.createAnswer({jsep:r,media:{audioSend:!1,videoSend:!1},success:function(e){console.log("Got SDP!",e);var r={request:"start",room:j};t.send({message:r,jsep:e})},error:function(e){console.error("WebRTC error:",e)}}))},iceState:function(e){w.log("ICE state of this WebRTC PeerConnection (feed #"+t.rfindex+") changed to "+e)},webrtcState:function(e){w.log("Janus says this WebRTC PeerConnection (feed #"+t.rfindex+") is "+(e?"up":"down")+" now")},onlocalstream:function(e){},onremotestream:function(e){console.log("Remote feed #"+t.rfindex+", stream:",e);0===y()("#remotevideo"+t.rfindex).length&&(y()("#videoremote"+t.rfindex).children("img").remove(),y()("#videoremote"+t.rfindex).append('<video class="rounded centered" id="waitingvideo'+t.rfindex+'" width="100%" height="100%" />'),y()("#videoremote"+t.rfindex).append('<video class="rounded centered relative hide" id="remotevideo'+t.rfindex+'" width="100%" height="100%" autoplay playsinline/>'),y()("#remotevideo"+t.rfindex).bind("playing",(function(){t.spinner&&t.spinner.stop(),t.spinner=null,y()("#waitingvideo"+t.rfindex).remove(),this.videoWidth&&y()("#remotevideo"+t.rfindex).removeClass("hide").show(),"firefox"===w.webRTCAdapter.browserDetails.browser&&setTimeout((function(){var e=y()("#remotevideo"+t.rfindex).get(0).videoWidth,r=y()("#remotevideo"+t.rfindex).get(0).videoHeight;y()("#curres"+t.rfindex).removeClass("hide").text(e+"x"+r).show()}),2e3)}))),w.attachMediaStream(y()("#remotevideo"+t.rfindex).get(0),e);var r=e.getVideoTracks();r&&0!==r.length?(y()("#videoremote"+t.rfindex+" .no-video-container").remove(),y()("#remotevideo"+t.rfindex).removeClass("hide").show()):(y()("#remotevideo"+t.rfindex).hide(),0===y()("#videoremote"+t.rfindex+" .no-video-container").length&&y()("#videoremote"+t.rfindex).append('<img src="'+v+'" id="img1" class="card-media-image" style="width:300px;height:250px"></img>'))},oncleanup:function(){w.log(" ::: Got a cleanup notification (remote feed "+e+") :::"),t.spinner&&t.spinner.stop(),y()("#remotevideo"+t.rfindex).remove(),y()("#videoremote"+t.rfindex).append('<img src="'+v+'" id="img1" class="card-media-image" style="width:300px;height:250px"></img>')}})}w.init({debug:"all",callback:function(){A=new w({server:"https://janus-test.yootok.com/janus",success:function(){A.attach({plugin:"janus.plugin.videoroom",opaqueId:x,success:function(e){R=e,w.log("Plugin attached! ("+R.getPlugin()+", id="+R.getId()+")"),w.log("  -- This is a publisher/manager");var r=w.randomString(12),n={request:"join",room:j,ptype:"publisher",display:r};r,R.send({message:n})},error:function(e){w.error("  -- Error attaching plugin...",e)},consentDialog:function(e){w.debug("Consent dialog should be "+(e?"on":"off")+" now")},mediaState:function(e,r){w.log("Janus "+(r?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){w.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(n,o){w.debug(" ::: Got a message (publisher) :::"),w.debug(n);var t=n.videoroom;if(w.debug("Event: "+t),void 0!=t&&null!=t)if("joined"===t){if(P=n.id,I=n.private_id,console.log("Successfully joined room "+n.room+" with ID "+P),e(!0),void 0!==n.publishers&&null!==n.publishers){var i=n.publishers;for(var a in console.log("Got a list of available publishers/feeds:"),console.log(i),i){var s=i[a].id,d=i[a].display,c=i[a].audio_codec,l=i[a].video_codec;console.log("  >> ["+s+"] "+d+" (audio: "+c+", video: "+l+")")}}}else if("destroyed"===t)w.warn("The room has been destroyed!"),console.error("The room has been destroyed");else if("event"===t)if(void 0!==n.publishers&&null!==n.publishers){console.log("new publishers!");var u=n.publishers;for(var f in u){var v=u[f].id,g=u[f].display,m=u[f].audio_codec,p=u[f].video_codec;console.log("  >> ["+v+"] "+g+" (audio: "+m+", video: "+p+")"),r(v,0,0,p)}}else if(void 0!==n.leaving&&null!==n.leaving);else if(void 0!==n.unpublished&&null!==n.unpublished){if("ok"===n.unpublished)return void R.hangup()}else void 0!==n.error&&null!==n.error&&(426===n.error_code||alert(n.error));if(void 0!==o&&null!==o){w.debug("Got room event. Handling SDP as well..."),w.debug(o),R.handleRemoteJsep({jsep:o});var b=n.audio_codec;V&&V.getAudioTracks()&&V.getAudioTracks().length>0&&!b&&alert("Our audio stream has been rejected, viewers won't hear us");var h=n.video_codec;V&&V.getVideoTracks()&&V.getVideoTracks().length>0&&!h&&(alert("Our video stream has been rejected, viewers won't see us"),y()("#myvideo").hide(),y()("#videolocal").append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon" style="height: 100%;"></i><span class="no-video-text" style="font-size: 16px;">Video rejected, no webcam</span></div>'))}},onlocalstream:function(e){console.log(" ::: Got a local stream :::",e),V=e;var r=document.querySelector("video#localvideo"),n=e.getVideoTracks();console.log("Using video device: ".concat(n[0].label)),r.srcObject=e},oncleanup:function(){w.log(" ::: Got a cleanup notification: we are unpublished now :::"),V=null}})},error:function(e){w.error(e),alert(e)},destroyed:function(){console.log("destroyed")}})}})}},{key:"render",value:function(){return Object(D.jsxs)("div",{className:"App",children:[Object(D.jsx)("header",{className:"App-header",children:Object(D.jsx)("div",{children:Object(D.jsx)("div",{id:"myvideo",className:"container shorter",children:Object(D.jsx)("video",{id:"localvideo",className:"rounded centered",width:"100%",height:"100%",autoPlay:!0,playsInline:!0,muted:"muted"})})})}),Object(D.jsx)("h3",{id:"title"}),Object(D.jsx)(k.a,{children:Object(D.jsxs)(T.a,{children:[Object(D.jsxs)(C.a,{children:[Object(D.jsx)("div",{id:"videoremote1",className:"container"}),Object(D.jsx)("h3",{id:"callername",children:"Participant 1"})]}),Object(D.jsxs)(C.a,{children:[Object(D.jsx)("div",{id:"videoremote2",className:"container"}),Object(D.jsx)("h3",{id:"callername",children:"Participant 2"})]}),Object(D.jsxs)(C.a,{children:[Object(D.jsx)("div",{id:"videoremote3",className:"container"}),Object(D.jsx)("h3",{id:"callername",children:"Participant 3"})]})]})})]})}}]),n}(t.a.Component),M=function(e){var r=e.history;return Object(D.jsx)("div",{className:"App",children:Object(D.jsxs)("header",{className:"App-header",children:[Object(D.jsxs)("p",{children:["Welcome to ",Object(D.jsx)("code",{children:"YOOTOK"})," video room (powered by Janus)."]}),Object(D.jsx)("button",{onClick:function(){r.push("/room")},children:"Join Room"})]})})};var N=function(){return Object(D.jsx)(s.a,{basename:"/",children:Object(D.jsx)("div",{className:"main-container",children:Object(D.jsx)(D.Fragment,{children:Object(D.jsxs)(d.c,{children:[Object(D.jsx)(d.a,{path:"/",exact:!0,component:M}),Object(D.jsx)(d.a,{path:"/room",component:E})]})})})})},L=(n(40),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,46)).then((function(r){var n=r.getCLS,o=r.getFID,t=r.getFCP,i=r.getLCP,a=r.getTTFB;n(e),o(e),t(e),i(e),a(e)}))});a.a.render(Object(D.jsx)(t.a.StrictMode,{children:Object(D.jsx)(N,{})}),document.getElementById("root")),L()}},[[41,1,2]]]);
//# sourceMappingURL=main.82b37fd6.chunk.js.map